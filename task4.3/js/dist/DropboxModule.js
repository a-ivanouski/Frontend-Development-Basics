"use strict";angular.module("my",["dropboxModule"]).controller("contr",["$scope","$http","dropboxService",function(e,t,n){function o(t){e.CurrentFolder.path=t.data.path,e.CurrentFolder.files=[];for(var n=0;n<t.data.contents.length;n++){var o=r(t.data.contents[n].path,t.data.contents[n].is_dir);e.CurrentFolder.files.push(o)}}function r(e,t){return{path:e,isFolder:t}}e.token="",e.hideContent=!1,e.InfoDropbox={name:"",email:""},e.CurrentFolder={path:"",files:[]},e.authorize=function(){window.open(n.getLinkForToken("1jgu22rx35z8ys4"),"_blank","top=200, left=300, width=800, height=500")},e.back=function(){var t,r=e.CurrentFolder.path,a="";for(t=r.length;t>0&&"/"!==r[t];t--);e.CurrentFolder.path="load",e.CurrentFolder.files=[],a=r.substring(0,t),n.getFolderInfo(a.length?a:"/",e.token).then(o)},e.toRoot=function(){e.CurrentFolder.path="load",e.CurrentFolder.files=[],n.getFolderInfo("/",e.token).then(o)},e.downloadFile=function(e,t){n.downloadFile(e,t).then(function(e){var t=document.createElement("a");t.setAttribute("href",e.data.url),t.click()})},e.GetContent=function(t){t.isFolder&&(e.CurrentFolder.path="load",e.CurrentFolder.files=[],n.getFolderInfo(t.path,e.token).then(o))},e.initial=function(){n.getPromiseToken(e.secret,"1jgu22rx35z8ys4","yhewhb4kn7uo9gb").then(function(t){e.token=t.data.access_token,e.hideContent=!0,n.getProfileInfo(e.token).then(function(t){e.InfoDropbox.display_name=t.data.display_name,e.InfoDropbox.email=t.data.email}),n.getFolderInfo("/",e.token).then(o)})}}]);